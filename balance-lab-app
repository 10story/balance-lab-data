<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balance Lab App 1.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0fbfd 0%, #e6f9fc 100%);
            min-height: 100vh;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Top Content Area */
        .top-section {
            display: flex;
            gap: 20px;
        }

        /* Main Content Area */
        .content-area {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }

        /* Fullscreen button */
        .fullscreen-btn {
            position: absolute;
            bottom: 15px;
            right: 15px;
            z-index: 100;
            background: rgba(80, 45, 140, 0.9);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-btn.hidden {
            display: none;
        }

        .content-area:fullscreen .fullscreen-btn {
            bottom: 30px;
            right: 30px;
            padding: 15px;
        }

        .fullscreen-btn:hover {
            background: rgba(63, 36, 112, 0.95);
            transform: scale(1.05);
        }

        .fullscreen-btn svg {
            width: 20px;
            height: 20px;
        }

        .content-area:fullscreen .fullscreen-btn svg {
            width: 24px;
            height: 24px;
        }

        .content-area:fullscreen {
            border-radius: 0;
        }

        /* Scale up content in fullscreen mode */
        .content-area:fullscreen .slide-container {
            height: 100vh;
        }

        .content-area:fullscreen .video-container {
            height: 100vh;
        }

        .content-area:fullscreen .timer-container {
            height: 100vh;
        }

        .content-area:fullscreen .emulator-container {
            height: 100vh;
        }

        /* Slide View */
        .slide-container {
            width: 100%;
            height: 600px;
            background: no-repeat center center;
            background-size: contain;
            position: relative;
        }

        .slide-container.clickable {
            cursor: default;
        }

        .slide-container.clickable::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(80, 45, 140, 0.9);
            color: white;
            padding: 20px 30px;
            border-radius: 50%;
            font-size: 32px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            pointer-events: all;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slide-container.clickable:hover::after {
            background: rgba(63, 36, 112, 0.95);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .slide-container.hidden {
            display: none;
        }

        .slide-controls {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(255,255,255,0.95);
            padding: 10px 15px;
            border-radius: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .content-area:fullscreen .slide-controls {
            bottom: 30px;
            padding: 15px 25px;
            gap: 15px;
        }

        .slide-nav-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: #502D8C;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .content-area:fullscreen .slide-nav-btn {
            width: 60px;
            height: 60px;
            font-size: 24px;
        }

        .slide-nav-btn:hover {
            background: #3F2470;
            transform: scale(1.05);
        }

        .slide-counter {
            display: flex;
            align-items: center;
            padding: 0 15px;
            font-weight: 600;
            color: #374151;
        }

        .content-area:fullscreen .slide-counter {
            font-size: 24px;
            padding: 0 25px;
        }

        /* Emulator View */
        .emulator-container {
            width: 100%;
            height: 600px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: #f8f9fa;
        }

        .emulator-container.active {
            display: flex;
        }

        .emulator-header {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 50;
        }

        .content-area:fullscreen .emulator-header {
            top: 30px;
            right: 30px;
        }

        .close-emulator-btn {
            background: #502D8C;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .content-area:fullscreen .close-emulator-btn {
            padding: 12px 20px;
            font-size: 16px;
        }

        .close-emulator-btn:hover {
            background: #3F2470;
        }

        /* Timer View */
        .timer-container {
            width: 100%;
            height: 600px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
        }

        .timer-container.active {
            display: flex;
        }

        .timer-header {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 50;
        }

        .content-area:fullscreen .timer-header {
            top: 30px;
            right: 30px;
        }

        .close-timer-btn {
            background: #502D8C;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .content-area:fullscreen .close-timer-btn {
            padding: 12px 20px;
            font-size: 16px;
        }

        .close-timer-btn:hover {
            background: #3F2470;
        }

        .timer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            width: 100%;
            max-width: 600px;
        }

        .content-area:fullscreen .timer-content {
            gap: 35px;
            transform: scale(1.3);
        }

        /* Timer Control Panel - Fixed Height */
        .timer-control-panel {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 15px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            min-height: 70px;
        }

        /* Timer Mode Toggle */
        .timer-mode-toggle {
            display: flex;
            gap: 0;
            background: #E5E7EB;
            border-radius: 8px;
            padding: 4px;
        }

        .mode-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: #6B7280;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .mode-btn.active {
            background: white;
            color: #502D8C;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .mode-btn:hover:not(.active) {
            color: #374151;
        }

        /* Countdown Time Setter */
        .countdown-setter {
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0.4;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .countdown-setter.active {
            opacity: 1;
            pointer-events: all;
        }

        .time-input-group {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .time-input {
            width: 50px;
            padding: 6px 8px;
            border: 2px solid #E5E7EB;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            color: #374151;
        }

        .time-input:focus {
            outline: none;
            border-color: #502D8C;
        }

        .time-label {
            font-size: 11px;
            color: #6B7280;
            font-weight: 500;
        }

        .set-time-btn {
            padding: 6px 14px;
            background: #502D8C;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .set-time-btn:hover {
            background: #3F2470;
        }

        /* Analog Clock */
        .analog-clock {
            position: relative;
        }

        .clock-face {
            width: 180px;
            height: 180px;
            border: 3px solid #E5E7EB;
            border-radius: 50%;
            background: white;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .clock-face.warning {
            border-color: #F59E0B;
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3);
        }

        .clock-face.alert {
            border-color: #EF4444;
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.4);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        .clock-numbers {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .number {
            position: absolute;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            font-size: 13px;
            color: #6B7280;
            text-align: center;
            width: 20px;
        }

        .number.zero { top: 10px; left: 50%; transform: translateX(-50%); }
        .number.fifteen { right: 10px; top: 50%; transform: translateY(-50%); }
        .number.thirty { bottom: 10px; left: 50%; transform: translateX(-50%); }
        .number.fortyfive { left: 10px; top: 50%; transform: translateY(-50%); }

        /* Tick marks */
        .tick-marks {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .tick {
            position: absolute;
            background: #D1D5DB;
            left: 50%;
            top: 10px;
            transform-origin: 0 80px;
        }

        .tick.long {
            width: 2px;
            height: 9px;
            margin-left: -1px;
        }

        .tick.short {
            width: 1px;
            height: 5px;
            margin-left: -0.5px;
        }

        .clock-hands {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .hand {
            position: absolute;
            background: #502D8C;
            transform-origin: bottom center;
            border-radius: 2px;
        }

        .minute-hand {
            width: 3px;
            height: 60px;
            margin-left: -1.5px;
            margin-top: -60px;
        }

        .second-hand {
            width: 2px;
            height: 70px;
            background: #502D8C;
            margin-left: -1px;
            margin-top: -70px;
        }

        .center-dot {
            width: 10px;
            height: 10px;
            background: #502D8C;
            border-radius: 50%;
            position: absolute;
            top: -5px;
            left: -5px;
            border: 2px solid white;
        }

        /* Digital Display */
        .digital-display {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            padding: 30px 35px 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            width: 100%;
        }

        .digital-time {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 56px;
            font-weight: 700;
            color: #502D8C;
            text-align: center;
            margin-bottom: 30px;
            letter-spacing: 4px;
        }

        .digital-time.warning {
            color: #F59E0B;
        }

        .digital-time.alert {
            color: #EF4444;
        }

        .timer-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .timer-control-btn {
            padding: 10px 24px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            background: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            font-size: 14px;
            color: #6B7280;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timer-control-btn:hover {
            border-color: #502D8C;
            color: #502D8C;
            background: #F9FAFB;
        }

        .timer-control-btn.start {
            color: #502D8C;
            border-color: #502D8C;
        }

        .timer-control-btn.start:hover {
            background: #502D8C;
            color: white;
        }

        .timer-control-btn.stop {
            color: #502D8C;
            border-color: #502D8C;
        }

        .timer-control-btn.stop:hover {
            background: #502D8C;
            color: white;
        }

        .timer-control-btn.reset {
            color: #6B7280;
            border-color: #E5E7EB;
        }

        .timer-control-btn.reset:hover {
            border-color: #9CA3AF;
            color: #374151;
            background: #F9FAFB;
        }

        /* Video View */
        .video-container {
            width: 100%;
            height: 600px;
            display: none;
            flex-direction: column;
            position: relative;
            background: #000;
        }

        .video-container.active {
            display: flex;
        }

        .video-header {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 50;
        }

        .content-area:fullscreen .video-header {
            top: 30px;
            right: 30px;
        }

        .close-video-btn {
            background: #502D8C;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .content-area:fullscreen .close-video-btn {
            padding: 12px 20px;
            font-size: 16px;
        }

        .close-video-btn:hover {
            background: #3F2470;
        }

        .video-player {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .content-area:fullscreen .video-player {
            padding: 100px 40px 40px;
        }

        .video-player-inner {
            width: 100%;
            max-width: 900px;
        }

        .content-area:fullscreen .video-player-inner {
            max-width: 1800px;
        }

        /* Right Sidebar */
        .sidebar {
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sidebar.hidden {
            display: none;
        }

        /* Teaching Tools Panel */
        .teaching-tools {
            background: transparent;
            border-radius: 0;
            padding: 0;
            box-shadow: none;
        }

        /* Action Buttons */
        .action-btn {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid transparent;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            text-align: left;
        }

        .action-btn.video {
            background: white;
            color: #2D3B8D;
            border: 2px solid #2D3B8D;
        }

        .action-btn.video:hover {
            background: #f6f7fb;
            transform: translateY(-1px);
        }

        .action-btn.timer {
            background: white;
            color: #698C3C;
            border: 2px solid #698C3C;
        }

        .action-btn.timer:hover {
            background: #f8faf6;
            transform: translateY(-1px);
        }

        .action-btn.timer.active {
            background: #698C3C;
            color: white;
        }

        .action-btn.slides {
            background: white;
            color: #502D8C;
            border: 2px solid #502D8C;
        }

        .action-btn.slides:hover {
            background: #f8f6fb;
            transform: translateY(-1px);
        }

        .action-btn.slides.active {
            background: #502D8C;
            color: white;
        }

        .action-btn.emulator {
            background: white;
            color: #19C1E1;
            border: 2px solid #19C1E1;
        }

        .action-btn.emulator:hover {
            background: #f6fcfd;
            transform: translateY(-1px);
        }

        .action-btn.emulator.active {
            background: #19C1E1;
            color: white;
        }

        .action-btn .icon {
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
        }

        /* Buy Kits Button */
        .buy-kits-btn {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #9CA3AF;
            background: white;
            color: #9CA3AF;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: left;
            margin-top: auto;
        }

        .buy-kits-btn:hover {
            background: #F3F4F6;
            transform: translateY(-1px);
        }

        .buy-kits-btn .icon {
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
        }

        /* Printables Button */
        .action-btn.printables {
            background: white;
            color: #19C1E1;
            border: 2px solid #19C1E1;
        }

        .action-btn.printables:hover {
            background: #f6fcfd;
            transform: translateY(-1px);
        }

        /* Back to Top Button */
        .back-to-top-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: rgba(80, 45, 140, 0.9);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 14px;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .back-to-top-btn.visible {
            opacity: 1;
            pointer-events: all;
        }

        .back-to-top-btn:hover {
            background: rgba(63, 36, 112, 0.95);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        /* Bottom Sections */
        .bottom-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: calc(100% - 300px);
        }

        /* Lesson Navigation */
        .lesson-nav {
            background: transparent;
            border-radius: 0;
            padding: 0;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lessons-header {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            color: #6B7280;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .lesson-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(56px, 1fr));
            gap: 12px;
            margin-top: 0;
            max-width: 600px;
            width: 100%;
        }

        .lesson-btn {
            padding: 12px 16px;
            background: #F3F4F6;
            border: 2px solid #BCBEC0;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-width: 56px;
            min-height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lesson-btn.home {
            font-size: 13px;
        }

        .lesson-btn:hover {
            background: #E5E7EB;
            border-color: #19C1E1;
        }

        .lesson-btn.active {
            background: #502D8C;
            color: white;
            border-color: #502D8C;
        }

        /* Resources Panel */
        .resources {
            background: transparent;
            border-radius: 0;
            padding: 0;
            box-shadow: none;
        }

        .resources.hidden {
            display: none;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-icon {
            width: 20px;
            height: 20px;
            background: #19C1E1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .resources-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .resource-btn {
            padding: 14px 16px;
            background: #F8FAFC;
            border: 1px solid #BCBEC0;
            border-radius: 6px;
            font-size: 20px;
            font-weight: 600;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            line-height: 1.3;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .resource-btn:hover {
            background: #19C1E1;
            border-color: #19C1E1;
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .sidebar {
                width: 250px;
            }
            
            .bottom-section {
                width: calc(100% - 270px);
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 10px;
            }
            
            .top-section {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .bottom-section {
                width: 100%;
            }
            
            .resources-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Top Section -->
        <div class="top-section">
            <!-- Main Content Area -->
            <div class="content-area" id="contentArea">
                <!-- Fullscreen Button -->
                <button id="fullscreenBtn" class="fullscreen-btn">
                    <svg id="expandIcon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 8V2H8M18 8V2H12M2 12V18H8M18 12V18H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <svg id="collapseIcon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path d="M8 2V8H2M12 2V8H18M8 18V12H2M12 18V12H18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>

                <!-- Slide View -->
                <div id="slideView" class="slide-container">
                    <div class="slide-controls">
                        <button id="prevSlide" class="slide-nav-btn">\'8b</button>
                        <div id="slideCounter" class="slide-counter">1 / 1</div>
                        <button id="nextSlide" class="slide-nav-btn">\'9b</button>
                    </div>
                </div>

                <!-- Emulator View -->
                <div id="emulatorView" class="emulator-container">
                    <div class="emulator-header">
                        <button id="closeEmulator" class="close-emulator-btn">Close Emulator</button>
                    </div>
                    <div style="text-align: center; color: #6B7280;">
                        <h2 style="font-size: 24px; margin-bottom: 10px; color: #374151;">Cups & Cubes</h2>
                        <p>Emulator Coming Soon</p>
                    </div>
                </div>

                <!-- Timer View -->
                <div id="timerView" class="timer-container">
                    <div class="timer-header">
                        <button id="closeTimer" class="close-timer-btn">Close Timer</button>
                    </div>
                    <div class="timer-content">
                        <!-- Timer Control Panel - Fixed Height -->
                        <div class="timer-control-panel">
                            <!-- Timer Mode Toggle -->
                            <div class="timer-mode-toggle">
                                <button id="countUpBtn" class="mode-btn active">COUNT UP</button>
                                <button id="countDownBtn" class="mode-btn">COUNT DOWN</button>
                            </div>

                            <!-- Countdown Time Setter - Always visible, disabled when not in use -->
                            <div id="countdownSetter" class="countdown-setter">
                                <div class="time-input-group">
                                    <input type="number" id="countdownMinutes" class="time-input" min="0" max="99" value="5" />
                                    <span class="time-label">min</span>
                                </div>
                                <div class="time-input-group">
                                    <input type="number" id="countdownSeconds" class="time-input" min="0" max="59" value="0" />
                                    <span class="time-label">sec</span>
                                </div>
                                <button id="setTimeBtn" class="set-time-btn">SET</button>
                            </div>
                        </div>

                        <!-- Analog Clock -->
                        <div class="analog-clock">
                            <div id="clockFace" class="clock-face">
                                <div class="tick-marks">
                                    <div class="tick long" style="transform: rotate(0deg);"></div>
                                    <div class="tick short" style="transform: rotate(6deg);"></div>
                                    <div class="tick short" style="transform: rotate(12deg);"></div>
                                    <div class="tick short" style="transform: rotate(18deg);"></div>
                                    <div class="tick short" style="transform: rotate(24deg);"></div>
                                    <div class="tick long" style="transform: rotate(30deg);"></div>
                                    <div class="tick short" style="transform: rotate(36deg);"></div>
                                    <div class="tick short" style="transform: rotate(42deg);"></div>
                                    <div class="tick short" style="transform: rotate(48deg);"></div>
                                    <div class="tick short" style="transform: rotate(54deg);"></div>
                                    <div class="tick long" style="transform: rotate(60deg);"></div>
                                    <div class="tick short" style="transform: rotate(66deg);"></div>
                                    <div class="tick short" style="transform: rotate(72deg);"></div>
                                    <div class="tick short" style="transform: rotate(78deg);"></div>
                                    <div class="tick short" style="transform: rotate(84deg);"></div>
                                    <div class="tick long" style="transform: rotate(90deg);"></div>
                                    <div class="tick short" style="transform: rotate(96deg);"></div>
                                    <div class="tick short" style="transform: rotate(102deg);"></div>
                                    <div class="tick short" style="transform: rotate(108deg);"></div>
                                    <div class="tick short" style="transform: rotate(114deg);"></div>
                                    <div class="tick long" style="transform: rotate(120deg);"></div>
                                    <div class="tick short" style="transform: rotate(126deg);"></div>
                                    <div class="tick short" style="transform: rotate(132deg);"></div>
                                    <div class="tick short" style="transform: rotate(138deg);"></div>
                                    <div class="tick short" style="transform: rotate(144deg);"></div>
                                    <div class="tick long" style="transform: rotate(150deg);"></div>
                                    <div class="tick short" style="transform: rotate(156deg);"></div>
                                    <div class="tick short" style="transform: rotate(162deg);"></div>
                                    <div class="tick short" style="transform: rotate(168deg);"></div>
                                    <div class="tick short" style="transform: rotate(174deg);"></div>
                                    <div class="tick long" style="transform: rotate(180deg);"></div>
                                    <div class="tick short" style="transform: rotate(186deg);"></div>
                                    <div class="tick short" style="transform: rotate(192deg);"></div>
                                    <div class="tick short" style="transform: rotate(198deg);"></div>
                                    <div class="tick short" style="transform: rotate(204deg);"></div>
                                    <div class="tick long" style="transform: rotate(210deg);"></div>
                                    <div class="tick short" style="transform: rotate(216deg);"></div>
                                    <div class="tick short" style="transform: rotate(222deg);"></div>
                                    <div class="tick short" style="transform: rotate(228deg);"></div>
                                    <div class="tick short" style="transform: rotate(234deg);"></div>
                                    <div class="tick long" style="transform: rotate(240deg);"></div>
                                    <div class="tick short" style="transform: rotate(246deg);"></div>
                                    <div class="tick short" style="transform: rotate(252deg);"></div>
                                    <div class="tick short" style="transform: rotate(258deg);"></div>
                                    <div class="tick short" style="transform: rotate(264deg);"></div>
                                    <div class="tick long" style="transform: rotate(270deg);"></div>
                                    <div class="tick short" style="transform: rotate(276deg);"></div>
                                    <div class="tick short" style="transform: rotate(282deg);"></div>
                                    <div class="tick short" style="transform: rotate(288deg);"></div>
                                    <div class="tick short" style="transform: rotate(294deg);"></div>
                                    <div class="tick long" style="transform: rotate(300deg);"></div>
                                    <div class="tick short" style="transform: rotate(306deg);"></div>
                                    <div class="tick short" style="transform: rotate(312deg);"></div>
                                    <div class="tick short" style="transform: rotate(318deg);"></div>
                                    <div class="tick short" style="transform: rotate(324deg);"></div>
                                    <div class="tick long" style="transform: rotate(330deg);"></div>
                                    <div class="tick short" style="transform: rotate(336deg);"></div>
                                    <div class="tick short" style="transform: rotate(342deg);"></div>
                                    <div class="tick short" style="transform: rotate(348deg);"></div>
                                    <div class="tick short" style="transform: rotate(354deg);"></div>
                                </div>
                                <div class="clock-numbers">
                                    <div class="number zero">0</div>
                                    <div class="number fifteen">15</div>
                                    <div class="number thirty">30</div>
                                    <div class="number fortyfive">45</div>
                                </div>
                                <div class="clock-hands">
                                    <div id="minuteHand" class="hand minute-hand"></div>
                                    <div id="secondHand" class="hand second-hand"></div>
                                    <div class="center-dot"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Digital Display -->
                        <div class="digital-display">
                            <div id="digitalTime" class="digital-time">00:00</div>
                            <div class="timer-controls">
                                <button id="startStopBtn" class="timer-control-btn start">START</button>
                                <button id="resetBtn" class="timer-control-btn reset">RESET</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Video View -->
                <div id="videoView" class="video-container">
                    <div class="video-header">
                        <button id="closeVideo" class="close-video-btn">Close Video</button>
                    </div>
                    <div id="videoPlayer" class="video-player">
                        <!-- Wistia player will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div id="sidebar" class="sidebar">
                <!-- Teaching Tools Panel -->
                <div class="teaching-tools">
                    <div id="controlButtonsContainer">
                        <!-- Control buttons will be dynamically generated here -->
                    </div>
                    
                    <!-- Dynamic Video Buttons Container -->
                    <div id="videoButtonsContainer">
                        <!-- Video buttons will be dynamically generated here -->
                    </div>
                </div>

                <!-- Buy Kits Button -->
                <button class="buy-kits-btn" onclick="window.open('https://www.10storylearning.com/how-to-buy-10story', '_blank')">
                    <span class="icon">
                        <svg width="32" height="32" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 2H3.5L4.5 6M4.5 6L6 14H16L18 6H4.5Z" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="7" cy="17" r="1" fill="currentColor"/>
                            <circle cx="15" cy="17" r="1" fill="currentColor"/>
                            <rect x="7" y="8" width="2" height="4" fill="currentColor" rx="0.3"/>
                            <rect x="11" y="8" width="2" height="4" fill="currentColor" rx="0.3"/>
                            <rect x="15" y="8" width="2" height="4" fill="currentColor" rx="0.3"/>
                        </svg>
                    </span>
                    <span>Order Kits</span>
                </button>
            </div>
        </div>

        <!-- Bottom Section -->
        <div class="bottom-section">
            <!-- Lesson Navigation - spans full width under main content -->
            <div class="lesson-nav">
                <div class="lessons-header">LESSONS</div>
                <div id="lessonGrid" class="lesson-grid">
                    <!-- Lesson buttons will be dynamically generated here -->
                </div>
            </div>

            <!-- Printables Panel -->
            <div id="resources" class="resources">
                <div class="panel-title">
                    <div class="panel-icon"></div>
                    <span id="printablesTitle">Printables for Lesson 1</span>
                </div>
                
                <div id="resourcesContainer" class="resources-grid">
                    <!-- Resource buttons will be dynamically generated here -->
                </div>
            </div>
        </div>

        <!-- Back to Top Button -->
        <button id="backToTopBtn" class="back-to-top-btn">
            <span></span>
            <span>Back to Top</span>
        </button>
    </div>

    <script>
        // Global Variables
        let currentView = 'slides';
        let currentSlide = 1;
        let currentLesson = 0; // Start with HOME (lesson 0)
        let lessonData = {};

        // Embedded CSV Data \'97 TAKEN OUT



        // Timer Mode Variables
        let timerMode = 'countup'; // 'countup' or 'countdown'
        let countdownTargetTime = 300000; // 5 minutes in milliseconds (default)
        let timerStartTime = 0;
        let timerElapsedTime = 0;
        let timerInterval = null;
        let isTimerRunning = false;

        // Load lesson data from external JSON file
        function loadCSVData() {
            fetch('https://www.10storylearning.com/s/balance_lab_data.json')
                .then(response => response.json())
                .then(data => {
                    lessonData = data;
                    initializeApp();
                })
                .catch(error => {
                    console.error('Error loading lesson data:', error);
                    alert('Failed to load lesson data. Please refresh the page.');
                });
        }

        function initializeApp() {
            updateLessonButtons();
            switchToLesson(0); // Start with HOME
        }

        // Timer Mode Switching
        function switchToCountUp() {
            timerMode = 'countup';
            document.getElementById('countUpBtn').classList.add('active');
            document.getElementById('countDownBtn').classList.remove('active');
            document.getElementById('countdownSetter').classList.remove('active');
            resetTimer();
        }

        function switchToCountDown() {
            timerMode = 'countdown';
            document.getElementById('countDownBtn').classList.add('active');
            document.getElementById('countUpBtn').classList.remove('active');
            document.getElementById('countdownSetter').classList.add('active');
            resetTimer();
        }

        function setCountdownTime() {
            const minutes = parseInt(document.getElementById('countdownMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('countdownSeconds').value) || 0;
            countdownTargetTime = (minutes * 60 + seconds) * 1000;
            
            // Validate input
            if (countdownTargetTime <= 0) {
                countdownTargetTime = 60000; // Default to 1 minute if invalid
                document.getElementById('countdownMinutes').value = 1;
                document.getElementById('countdownSeconds').value = 0;
            }
            
            resetTimer();
        }

        // View Management
        function showSlides() {
            currentView = 'slides';
            document.getElementById('slideView').classList.remove('hidden');
            document.getElementById('emulatorView').classList.remove('active');
            document.getElementById('timerView').classList.remove('active');
            document.getElementById('videoView').classList.remove('active');
            updateActiveButtons();
        }

        function showEmulator() {
            currentView = 'emulator';
            document.getElementById('slideView').classList.add('hidden');
            document.getElementById('emulatorView').classList.add('active');
            document.getElementById('timerView').classList.remove('active');
            document.getElementById('videoView').classList.remove('active');
            updateActiveButtons();
        }

        function showTimer() {
            currentView = 'timer';
            document.getElementById('slideView').classList.add('hidden');
            document.getElementById('emulatorView').classList.remove('active');
            document.getElementById('timerView').classList.add('active');
            document.getElementById('videoView').classList.remove('active');
            updateActiveButtons();
        }

        function showVideo(wistiaId) {
            currentView = 'video';
            document.getElementById('slideView').classList.add('hidden');
            document.getElementById('emulatorView').classList.remove('active');
            document.getElementById('timerView').classList.remove('active');
            document.getElementById('videoView').classList.add('active');
            playVideo(wistiaId);
            updateActiveButtons();
        }

        function playVideo(wistiaId) {
            const videoPlayer = document.getElementById('videoPlayer');
            
            // Clear previous content
            videoPlayer.innerHTML = '';
            
            // Create container for responsive sizing
            const container = document.createElement('div');
            container.className = 'video-player-inner';
            
            // Create responsive wrapper
            const wrapper = document.createElement('div');
            wrapper.style.padding = '56.25% 0 0 0';
            wrapper.style.position = 'relative';
            
            // Create iframe
            const iframe = document.createElement('iframe');
            iframe.src = `https://fast.wistia.net/embed/iframe/${wistiaId}?seo=false&videoFoam=true`;
            iframe.title = 'Video Player';
            iframe.allow = 'autoplay; fullscreen';
            iframe.allowFullscreen = true;
            iframe.style.position = 'absolute';
            iframe.style.top = '0';
            iframe.style.left = '0';
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            
            // Load Wistia player script
            const script = document.createElement('script');
            script.src = 'https://fast.wistia.net/assets/external/E-v1.js';
            script.async = true;
            
            wrapper.appendChild(iframe);
            container.appendChild(wrapper);
            container.appendChild(script);
            videoPlayer.appendChild(container);
        }

        // Timer Functionality
        function startStopTimer() {
            if (isTimerRunning) {
                stopTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            if (timerMode === 'countup') {
                timerStartTime = Date.now() - timerElapsedTime;
            } else {
                // Countdown mode
                if (timerElapsedTime === 0) {
                    timerElapsedTime = countdownTargetTime;
                }
                timerStartTime = Date.now();
            }
            
            timerInterval = setInterval(updateTimer, 10);
            isTimerRunning = true;
            
            const btn = document.getElementById('startStopBtn');
            btn.textContent = 'STOP';
            btn.className = 'timer-control-btn stop';
        }

        function stopTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            
            const btn = document.getElementById('startStopBtn');
            btn.textContent = 'START';
            btn.className = 'timer-control-btn start';
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            
            if (timerMode === 'countup') {
                timerElapsedTime = 0;
            } else {
                timerElapsedTime = countdownTargetTime;
            }
            
            const btn = document.getElementById('startStopBtn');
            btn.textContent = 'START';
            btn.className = 'timer-control-btn start';
            
            // Remove warning/alert classes
            document.getElementById('clockFace').classList.remove('warning', 'alert');
            document.getElementById('digitalTime').classList.remove('warning', 'alert');
            
            updateTimerDisplay();
        }

        function updateTimer() {
            if (timerMode === 'countup') {
                timerElapsedTime = Date.now() - timerStartTime;
            } else {
                // Countdown mode
                const elapsed = Date.now() - timerStartTime;
                timerElapsedTime = Math.max(0, countdownTargetTime - elapsed);
                
                // Stop when countdown reaches zero
                if (timerElapsedTime === 0) {
                    stopTimer();
                }
            }
            
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const totalSeconds = Math.floor(timerElapsedTime / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            
            const digitalTime = document.getElementById('digitalTime');
            digitalTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const secondHand = document.getElementById('secondHand');
            const minuteHand = document.getElementById('minuteHand');
            
            const secondAngle = seconds * 6;
            secondHand.style.transform = `rotate(${secondAngle}deg)`;
            
            const minuteAngle = minutes * 6;
            minuteHand.style.transform = `rotate(${minuteAngle}deg)`;
            
            // Visual feedback for countdown mode
            if (timerMode === 'countdown' && isTimerRunning) {
                const clockFace = document.getElementById('clockFace');
                
                // Warning at 1 minute
                if (timerElapsedTime <= 60000 && timerElapsedTime > 10000) {
                    clockFace.classList.add('warning');
                    clockFace.classList.remove('alert');
                    digitalTime.classList.add('warning');
                    digitalTime.classList.remove('alert');
                }
                // Alert at 10 seconds
                else if (timerElapsedTime <= 10000 && timerElapsedTime > 0) {
                    clockFace.classList.remove('warning');
                    clockFace.classList.add('alert');
                    digitalTime.classList.remove('warning');
                    digitalTime.classList.add('alert');
                } else if (timerElapsedTime > 60000) {
                    clockFace.classList.remove('warning', 'alert');
                    digitalTime.classList.remove('warning', 'alert');
                }
            }
        }

        function updateActiveButtons() {
            // Remove active class from all control buttons
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class based on current view
            if (currentView === 'slides') {
                const slidesBtn = document.querySelector('.action-btn.slides');
                if (slidesBtn) slidesBtn.classList.add('active');
            } else if (currentView === 'emulator') {
                const emulatorBtn = document.querySelector('.action-btn.emulator');
                if (emulatorBtn) emulatorBtn.classList.add('active');
            } else if (currentView === 'timer') {
                const timerBtn = document.querySelector('.action-btn.timer');
                if (timerBtn) timerBtn.classList.add('active');
            }
        }

        // Slide Navigation
        function navigatePrevSlide(event) {
            if (event) {
                event.stopPropagation();
            }
            if (currentSlide > 1) {
                currentSlide--;
                showSlides();
                loadCurrentSlide();
            }
        }

        function navigateNextSlide(event) {
            if (event) {
                event.stopPropagation();
            }
            const lesson = lessonData[currentLesson];
            const maxSlides = lesson ? lesson.slides.length : 1;
            if (currentSlide < maxSlides) {
                currentSlide++;
                showSlides();
                loadCurrentSlide();
            }
        }

        function loadCurrentSlide() {
            const lesson = lessonData[currentLesson];
            if (!lesson || !lesson.slides[currentSlide - 1]) {
                return;
            }

            const slide = lesson.slides[currentSlide - 1];
            const slideContainer = document.getElementById('slideView');
            slideContainer.style.backgroundImage = `url('${slide.url}')`;
            
            // Handle clickable slides with videos
            if (slide.videoId) {
                slideContainer.classList.add('clickable');
                slideContainer.onclick = () => {
                    showVideo(slide.videoId);
                };
            } else {
                slideContainer.classList.remove('clickable');
                slideContainer.onclick = null;
            }
            
            const counter = document.getElementById('slideCounter');
            counter.textContent = `${currentSlide} / ${lesson.slides.length}`;
            
            // Hide slide controls on HOME page
            const slideControls = slideContainer.querySelector('.slide-controls');
            if (currentLesson === 0) {
                slideControls.style.display = 'none';
            } else {
                slideControls.style.display = 'flex';
            }
        }

        // Lesson Navigation
        function switchToLesson(lessonNum) {
            currentLesson = lessonNum;
            currentSlide = 1;
            
            loadCurrentSlide();
            updateControlButtons();
            updateVideoButtons();
            updateResourceButtons();
            updateLessonButtons();
            updatePrintablesTitle();
            showSlides();
            
            // Scroll to top when switching lessons
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Update back to top button after a short delay to allow for scroll
            setTimeout(updateBackToTopButton, 100);
            
            // Show/hide elements based on lesson
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const resources = document.getElementById('resources');
            
            if (lessonNum === 0) {
                // HOME page: hide fullscreen and resources (but keep sidebar)
                fullscreenBtn.classList.add('hidden');
                resources.classList.add('hidden');
            } else {
                // Regular lessons: show everything
                fullscreenBtn.classList.remove('hidden');
                resources.classList.remove('hidden');
            }
        }

        function updatePrintablesTitle() {
            const printablesTitle = document.getElementById('printablesTitle');
            if (currentLesson === 0) {
                printablesTitle.textContent = '';
            } else {
                printablesTitle.textContent = `Printables for Lesson ${currentLesson}`;
            }
        }

        function updateLessonButtons() {
            const lessonGrid = document.getElementById('lessonGrid');
            lessonGrid.innerHTML = '';
            
            // Add HOME button
            const homeBtn = document.createElement('button');
            homeBtn.className = `lesson-btn home ${currentLesson === 0 ? 'active' : ''}`;
            homeBtn.textContent = 'HOME';
            homeBtn.addEventListener('click', () => {
                switchToLesson(0);
            });
            lessonGrid.appendChild(homeBtn);
            
            // Add numbered lesson buttons (1-14)
            const totalLessons = Object.keys(lessonData).length - 1; // Subtract 1 for HOME
            
            for (let i = 1; i <= totalLessons; i++) {
                const btn = document.createElement('button');
                btn.className = `lesson-btn ${i === currentLesson ? 'active' : ''}`;
                btn.textContent = i.toString();
                btn.addEventListener('click', () => {
                    switchToLesson(i);
                });
                lessonGrid.appendChild(btn);
            }
        }

        function updateControlButtons() {
            const lesson = lessonData[currentLesson];
            if (!lesson) return;

            const container = document.getElementById('controlButtonsContainer');
            container.innerHTML = '';
            
            // Special case for HOME (lesson 0): add Welcome button
            if (currentLesson === 0) {
                const btn = document.createElement('button');
                btn.className = 'action-btn slides active';
                
                const iconSVG = `<svg width="32" height="32" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line x1="2" y1="3" x2="18" y2="3" stroke="currentColor" stroke-width="1.5"/>
                    <polygon points="10,2 11,4 9,4" fill="currentColor"/>
                    <rect x="1" y="5" width="18" height="13" rx="1" fill="none" stroke="currentColor" stroke-width="1.2"/>
                    <rect x="2" y="6" width="7" height="2" fill="#6B46C1" rx="0.5"/>
                    <rect x="11" y="6" width="7" height="2" fill="#0891B2" rx="0.5"/>
                    <rect x="3" y="10" width="5" height="3" fill="none" stroke="currentColor" stroke-width="0.8" rx="0.3"/>
                    <rect x="9" y="10" width="5" height="3" fill="none" stroke="currentColor" stroke-width="0.8" rx="0.3"/>
                    <rect x="15" y="10" width="2" height="3" fill="none" stroke="currentColor" stroke-width="0.8" rx="0.3"/>
                    <line x1="3" y1="15" x2="17" y2="15" stroke="currentColor" stroke-width="0.8"/>
                </svg>`;
                
                btn.innerHTML = `
                    <span class="icon">${iconSVG}</span>
                    <span>Welcome</span>
                `;
                
                btn.onclick = showSlides;
                container.appendChild(btn);
                return;
            }
            
            // Create control buttons based on CSV data for regular lessons
            lesson.controls.forEach(control => {
                const btn = document.createElement('button');
                btn.className = `action-btn ${control.type.replace(/\+/g, '-')}`;
                
                // Add appropriate icon based on control type
                let iconSVG = '';
                if (control.type === 'slides') {
                    iconSVG = `<svg width="32" height="32" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <line x1="2" y1="3" x2="18" y2="3" stroke="currentColor" stroke-width="1.5"/>
                        <polygon points="10,2 11,4 9,4" fill="currentColor"/>
                        <rect x="1" y="5" width="18" height="13" rx="1" fill="none" stroke="currentColor" stroke-width="1.2"/>
                        <rect x="2" y="6" width="7" height="2" fill="#6B46C1" rx="0.5"/>
                        <rect x="11" y="6" width="7" height="2" fill="#0891B2" rx="0.5"/>
                        <rect x="3" y="10" width="5" height="3" fill="none" stroke="currentColor" stroke-width="0.8" rx="0.3"/>
                        <rect x="9" y="10" width="5" height="3" fill="none" stroke="currentColor" stroke-width="0.8" rx="0.3"/>
                        <rect x="15" y="10" width="2" height="3" fill="none" stroke="currentColor" stroke-width="0.8" rx="0.3"/>
                        <line x1="3" y1="15" x2="17" y2="15" stroke="currentColor" stroke-width="0.8"/>
                    </svg>`;
                } else if (control.type === 'cups and cubes') {
                    iconSVG = `<svg width="32" height="32" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 4L12 4L10 16L3 16Z" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M1 4H12" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                        <rect x="13.5" y="2" width="3" height="3" fill="#22C55E" rx="0.3"/>
                        <rect x="16" y="4.5" width="3" height="3" fill="#22C55E" rx="0.3"/>
                        <rect x="14" y="7" width="3" height="3" fill="#22C55E" rx="0.3"/>
                        <rect x="16.5" y="9.5" width="3" height="3" fill="#000000" rx="0.3"/>
                        <rect x="13" y="11" width="3" height="3" fill="#000000" rx="0.3"/>
                    </svg>`;
                } else if (control.type === 'timer') {
                    iconSVG = `<svg width="32" height="32" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="1.5"/>
                        <circle cx="10" cy="3" r="0.8" fill="currentColor"/>
                        <circle cx="17" cy="10" r="0.8" fill="currentColor"/>
                        <circle cx="10" cy="17" r="0.8" fill="currentColor"/>
                        <circle cx="3" cy="10" r="0.8" fill="currentColor"/>
                        <line x1="10" y1="10" x2="10" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <line x1="10" y1="10" x2="13" y2="7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <circle cx="10" cy="10" r="1" fill="currentColor"/>
                    </svg>`;
                }
                
                btn.innerHTML = `
                    <span class="icon">${iconSVG}</span>
                    <span>${control.name}</span>
                `;
                
                // Add click handler based on control type
                if (control.type === 'slides') {
                    btn.onclick = showSlides;
                } else if (control.type === 'cups and cubes') {
                    btn.onclick = showEmulator;
                } else if (control.type === 'timer') {
                    btn.onclick = showTimer;
                }
                
                container.appendChild(btn);
                
                // Add printables button after slides button
                if (control.type === 'slides' && lesson.resources.length > 0) {
                    const printablesBtn = document.createElement('button');
                    printablesBtn.className = 'action-btn printables';
                    printablesBtn.innerHTML = `
                        <span class="icon">
                            <svg width="32" height="32" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="4" y="2" width="12" height="16" rx="1" fill="none" stroke="currentColor" stroke-width="1.2"/>
                                <line x1="6" y1="6" x2="14" y2="6" stroke="currentColor" stroke-width="1"/>
                                <line x1="6" y1="9" x2="14" y2="9" stroke="currentColor" stroke-width="1"/>
                                <line x1="6" y1="12" x2="11" y2="12" stroke="currentColor" stroke-width="1"/>
                                <path d="M10 15L12 15" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                            </svg>
                        </span>
                        <span>Lesson ${currentLesson} Printables</span>
                    `;
                    printablesBtn.onclick = scrollToPrintables;
                    container.appendChild(printablesBtn);
                }
            });
        }

        function updateVideoButtons() {
            const lesson = lessonData[currentLesson];
            if (!lesson) return;

            const container = document.getElementById('videoButtonsContainer');
            container.innerHTML = '';
            
            lesson.videos.forEach(video => {
                const btn = document.createElement('button');
                btn.className = 'action-btn video';
                btn.innerHTML = `
                    <span class="icon">
                        <svg width="32" height="32" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2" y="4" width="16" height="10" rx="1.5" fill="none" stroke="currentColor" stroke-width="1.2"/>
                            <rect x="3" y="5" width="14" height="8" rx="0.5" fill="none" stroke="currentColor" stroke-width="0.8"/>
                            <polygon points="8,7.5 8,11.5 12,9.5" fill="currentColor"/>
                            <path d="M8 14L12 14" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                            <path d="M6 16L14 16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            <circle cx="15" cy="6" r="0.8" fill="#DC2626"/>
                            <circle cx="15" cy="8" r="0.8" fill="#DC2626"/>
                            <circle cx="15" cy="10" r="0.8" fill="#DC2626"/>
                        </svg>
                    </span>
                    ${video.title}
                `;
                
                btn.onclick = () => showVideo(video.wistiaId);
                
                container.appendChild(btn);
            });
        }

        function updateResourceButtons() {
            const lesson = lessonData[currentLesson];
            if (!lesson) return;

            const container = document.getElementById('resourcesContainer');
            container.innerHTML = '';
            
            lesson.resources.forEach(resource => {
                const btn = document.createElement('button');
                btn.className = 'resource-btn';
                btn.textContent = resource.name;
                btn.onclick = () => window.open(resource.url, '_blank');
                container.appendChild(btn);
            });
        }

        // Scroll to Printables
        function scrollToPrintables() {
            const resourcesSection = document.getElementById('resources');
            resourcesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Back to Top functionality
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show/hide back to top button based on scroll position
        function updateBackToTopButton() {
            const backToTopBtn = document.getElementById('backToTopBtn');
            const resourcesSection = document.getElementById('resources');
            
            if (!resourcesSection || currentLesson === 0) {
                backToTopBtn.classList.remove('visible');
                return;
            }
            
            const rect = resourcesSection.getBoundingClientRect();
            const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
            
            if (isVisible) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load CSV data
            loadCSVData();
            
            // Slide navigation - pass event to stop propagation
            document.getElementById('prevSlide').addEventListener('click', navigatePrevSlide);
            document.getElementById('nextSlide').addEventListener('click', navigateNextSlide);

            // Close buttons
            document.getElementById('closeEmulator').addEventListener('click', showSlides);
            document.getElementById('closeTimer').addEventListener('click', showSlides);
            document.getElementById('closeVideo').addEventListener('click', showSlides);

            // Timer controls
            document.getElementById('startStopBtn').addEventListener('click', startStopTimer);
            document.getElementById('resetBtn').addEventListener('click', resetTimer);

            // Timer mode toggle
            document.getElementById('countUpBtn').addEventListener('click', switchToCountUp);
            document.getElementById('countDownBtn').addEventListener('click', switchToCountDown);
            document.getElementById('setTimeBtn').addEventListener('click', setCountdownTime);

            // Fullscreen button
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);

            // Back to top button
            document.getElementById('backToTopBtn').addEventListener('click', scrollToTop);

            // Scroll listener for back to top button visibility
            window.addEventListener('scroll', updateBackToTopButton);
            window.addEventListener('resize', updateBackToTopButton);

            // Initialize timer display
            updateTimerDisplay();
        });

        // Fullscreen functionality
        function toggleFullscreen() {
            const contentArea = document.getElementById('contentArea');
            const expandIcon = document.getElementById('expandIcon');
            const collapseIcon = document.getElementById('collapseIcon');
            
            if (!document.fullscreenElement) {
                contentArea.requestFullscreen().then(() => {
                    expandIcon.style.display = 'none';
                    collapseIcon.style.display = 'block';
                }).catch((err) => {
                    console.error('Error attempting to enable fullscreen:', err);
                });
            } else {
                document.exitFullscreen().then(() => {
                    expandIcon.style.display = 'block';
                    collapseIcon.style.display = 'none';
                });
            }
        }

        // Update button icon when fullscreen changes (e.g., via ESC key)
        document.addEventListener('fullscreenchange', function() {
            const expandIcon = document.getElementById('expandIcon');
            const collapseIcon = document.getElementById('collapseIcon');
            if (document.fullscreenElement) {
                expandIcon.style.display = 'none';
                collapseIcon.style.display = 'block';
            } else {
                expandIcon.style.display = 'block';
                collapseIcon.style.display = 'none';
            }
        });
    </script>
</body>
</html>
